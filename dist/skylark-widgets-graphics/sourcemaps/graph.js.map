{"version":3,"sources":["graph.js"],"names":["define","eventer","Widget","graphics","Graph","inherit","_construct","parent","name","color","prototype","call","this","_elm","style","overflow","scaleMargin","buttonRadius","max","min","grid","document","createElement","position","marginLeft","appendChild","graph","addGraph","scale","createScale","size","i","removeChild","step","pointerEvents","Editor","theme","textColor","text","createTextNode","push","_updateScale","length","data","canvas","GaphLine","setOnChange","onChange","getGraph","onchange","setRange","j","values","_updateGraph","setValue","self","buttons","button","borderRadius","backgroundColor","cursor","marginTop","width","height","index","onmousedown","event","on","window","delta","movementY","y","stopPropagation","pop","update","Math","ceil","getValue","undefined","x","context","getContext","clearRect","strokeStyle","lineWidth","moveTo","beginPath","lineTo","left","top","stroke","_updateGrid","rect","_updateSize"],"mappings":"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","file":"../graph.js","sourcesContent":["define([\r\n\t\"skylark-domx-eventer\",\r\n\t\"skylark-widgets-base/widget\",\r\n\t\"./graphics\"\r\n],function(eventer, Widget,graphics){\r\n\t\"use strict\";\r\n\r\n\t/**\r\n\t * Graph element is used to draw interactive line graphs.\r\n\t *\r\n\t * It is meant to be used as input in forms to controls values in arrays.\r\n\t *\r\n\t * Multiple graph lines can be displayed, each graph line has a name that can be used to access its properties.\r\n\t * \r\n\t * @class Graph\r\n\t * @extends {Widget}\r\n\t * @param {Widget} parent Parent element.\r\n\t * @param {String} name Name of the default graph.\r\n\t * @param {String} color CSS hex color code of the default graph.\r\n\t */\r\n\tvar Graph = Widget.inherit({\r\n\r\n\t\t_construct : function (parent, name, color) {\r\n\t\t\tWidget.prototype._construct.call(this, parent, \"div\");\r\n\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis._elm.style.overflow = \"visible\";\r\n\r\n\t\t\t/**\r\n\t\t\t * Scale margin in pixels.\r\n\t\t\t *\r\n\t\t\t * @property scaleMargin\r\n\t\t\t * @type {Number}\r\n\t\t\t */\r\n\t\t\tthis.scaleMargin = 22;\r\n\r\n\t\t\t/**\r\n\t\t\t * Value button size.\r\n\t\t\t *\r\n\t\t\t * @property buttonRadius\r\n\t\t\t * @type {Number}\r\n\t\t\t */\r\n\t\t\tthis.buttonRadius = 10;\r\n\r\n\t\t\t/**\r\n\t\t\t * Maximum value displayed vertically.\r\n\t\t\t *\r\n\t\t\t * @property max\r\n\t\t\t * @type {Number}\r\n\t\t\t */\r\n\t\t\tthis.max = 1.0;\r\n\r\n\t\t\t/**\r\n\t\t\t * Minimum value displayed vertically.\r\n\t\t\t *\r\n\t\t\t * @property min\r\n\t\t\t * @type {Number}\r\n\t\t\t */\r\n\t\t\tthis.min = 0.0;\r\n\r\n\t\t\t/**\r\n\t\t\t * Grid canvas element.\r\n\t\t\t *\r\n\t\t\t * @property grid\r\n\t\t\t * @type {DOM}\r\n\t\t\t */\r\n\t\t\tthis.grid = document.createElement(\"canvas\");\r\n\t\t\tthis.grid.style.position = \"absolute\";\r\n\t\t\tthis.grid.style.marginLeft = this.scaleMargin + \"px\";\r\n\t\t\tthis._elm.appendChild(this.grid);\r\n\r\n\t\t\t/**\r\n\t\t\t * The graph lines stored in this graph.\r\n\t\t\t *\r\n\t\t\t * @property graph\r\n\t\t\t * @type {Array}\r\n\t\t\t */\r\n\t\t\tthis.graph = [];\r\n\t\t\tthis.addGraph(name, color);\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * Scale DOM elements.\r\n\t\t\t *\r\n\t\t\t * @property scale\r\n\t\t\t * @type {Array}\r\n\t\t\t */\r\n\t\t\tthis.scale = [];\r\n\t\t\tthis.createScale(3);\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * Create numeric scale for this graph.\r\n\t\t *\r\n\t\t * @method createScale\r\n\t\t * @param {Number} size Number of values in the scale.\r\n\t\t */\r\n\t\tcreateScale : function(size) {\r\n\t\t\tfor(var i = 0; i < this.scale; i++)\r\n\t\t\t{\r\n\t\t\t\tthis._elm.removeChild(this.scale[i]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar step = (this.max - this.min) / (size - 1);\r\n\r\n\t\t\tfor(var i = 0; i < size; i++)\r\n\t\t\t{\r\n\t\t\t\tvar scale = document.createElement(\"div\");\r\n\t\t\t\tscale.style.position = \"absolute\";\r\n\t\t\t\tscale.style.pointerEvents = \"none\";\r\n\t\t\t\tscale.style.color = Editor.theme.textColor;\r\n\r\n\t\t\t\tvar text = document.createTextNode(this.max - (step * i));\r\n\t\t\t\tscale.text = text;\r\n\t\t\t\tscale.appendChild(text);\r\n\r\n\t\t\t\tthis.scale.push(scale);\r\n\t\t\t\tthis._elm.appendChild(scale);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Update values of the scale.\r\n\t\t *\r\n\t\t * @method updateScale\r\n\t\t */\r\n\t\t_updateScale : function() {\r\n\t\t\tvar step = (this.max - this.min) / (this.scale.length - 1);\r\n\r\n\t\t\tfor(var i = 0; i < this.scale.length; i++)\r\n\t\t\t{\r\n\t\t\t\tthis.scale[(this.scale.length - 1) - i].text.data = this.min + (step * i);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Add new graph line.\r\n\t\t *\r\n\t\t * @method addGraph\r\n\t\t * @param {String} name Name of the graph.\r\n\t\t * @param {Color} color Color of the graph.\r\n\t\t */\r\n\t\taddGraph : function(name, color) {\r\n\t\t\tvar canvas = document.createElement(\"canvas\");\r\n\t\t\tcanvas.style.position = \"absolute\";\r\n\t\t\tcanvas.style.marginLeft = this.scaleMargin + \"px\";\r\n\t\t\tthis._elm.appendChild(canvas);\r\n\r\n\t\t\tthis.graph.push(new Graph.GaphLine(canvas, name, color));\r\n\t\t},\r\n\r\n\t\t/** \r\n\t\t * Attach onchange callback to a graph by its name.\r\n\t\t *\r\n\t\t * @method setOnChange\r\n\t\t * @param {Function} onChange\r\n\t\t * @param {String} name Graph name.\r\n\t\t */\r\n\t\tsetOnChange : function(onChange, name) \t{\r\n\t\t\tvar graph = this.getGraph(name);\r\n\t\t\tgraph.onchange = onChange;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set value range of the graph.\r\n\t\t *\r\n\t\t * @method setRange.\r\n\t\t * @param {Number} min\r\n\t\t * @param {Number} max\r\n\t\t */\r\n\t\tsetRange : function(min, max) {\r\n\t\t\tthis.min = min;\r\n\t\t\tthis.max = max;\r\n\r\n\t\t\t//Limit graphs values\r\n\t\t\tfor(var i in this.graph) {\r\n\t\t\t\tvar graph = this.graph[i];\r\n\r\n\t\t\t\tfor(var j = 0; j < graph.values.length; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(graph.values[j] < min)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tgraph.values[j] = min;\r\n\r\n\t\t\t\t\t\tif(graph.onchange !== null)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tgraph.onchange(graph.values);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(graph.values[j] > max)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tgraph.values[j] = max;\r\n\r\n\t\t\t\t\t\tif(graph.onchange !== null)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tgraph.onchange(graph.values);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateScale();\r\n\r\n\t\t\t//Update grid to fit new scale\r\n\t\t\tfor(var i = 0; i < this.graph.length; i++){\r\n\t\t\t\tthis._updateGraph(this.graph[i]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set values array to a graph using its name.\r\n\t\t *\r\n\t\t * @method setValue\r\n\t\t * @param {Array} values Array of numeric values.\r\n\t\t * @param {String} name Name of the graph line.\r\n\t\t */\r\n\t\tsetValue : function(values, name) {\t\r\n\t\t\tvar self = this;\r\n\t\t\tvar graph = this.getGraph(name);\r\n\r\n\t\t\t//Set values\r\n\t\t\tgraph.values = values;\r\n\r\n\t\t\t//Add buttons if necessary\r\n\t\t\twhile(graph.buttons.length < graph.values.length){\r\n\t\t\t\tvar button = document.createElement(\"div\");\r\n\t\t\t\tbutton.style.borderRadius = \"5px\";\r\n\t\t\t\tbutton.style.backgroundColor = graph.color;\r\n\t\t\t\tbutton.style.cursor = \"pointer\";\r\n\t\t\t\tbutton.style.position = \"absolute\";\r\n\t\t\t\tbutton.style.marginTop = \"-\" + (this.buttonRadius / 2) + \"px\";\r\n\t\t\t\tbutton.style.marginLeft = (this.scaleMargin - (this.buttonRadius / 2)) + \"px\";\r\n\t\t\t\tbutton.style.width = this.buttonRadius + \"px\";\r\n\t\t\t\tbutton.style.height = this.buttonRadius + \"px\";\r\n\t\t\t\tbutton.index = graph.buttons.length;\r\n\t\t\t\tbutton.graph = graph;\r\n\r\n\t\t\t\tbutton.onmousedown = function(event) {\r\n\t\t\t\t\tvar index = this.index;\r\n\t\t\t\t\tvar graph = this.graph;\r\n\t\t\t\t\t//var manager = new EventManager();\r\n\r\n\t\t\t\t\t//manager.add(window, \"mousemove\", function(event)\r\n\t\t\t\t\teventer.on(window, \"mousemove\", function(event) {\r\n\t\t\t\t\t\tvar delta = event.movementY;\r\n\r\n\t\t\t\t\t\tgraph.values[index] -= (delta * ((self.max - self.min) / self.size.y));\r\n\r\n\t\t\t\t\t\tif(graph.values[index] > self.max)\t{\r\n\t\t\t\t\t\t\tgraph.values[index] = self.max;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(graph.values[index] < self.min)\t{\r\n\t\t\t\t\t\t\tgraph.values[index] = self.min;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(graph.onchange !== null)\t{\r\n\t\t\t\t\t\t\tgraph.onchange(graph.values);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself._updateGraph(graph);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t//manager.add(window, \"mouseup\", function(event)\r\n\t\t\t\t\t//{\t\r\n\t\t\t\t\t//\tmanager.destroy();\r\n\t\t\t\t\t//});\r\n\t\t\t\t\t//manager.create();\r\n\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis._elm.appendChild(button);\r\n\t\t\t\tgraph.buttons.push(button);\r\n\t\t\t}\r\n\r\n\t\t\t//Remove buttons if necessary\r\n\t\t\twhile(graph.buttons.length > graph.values.length){\r\n\t\t\t\tthis._elm.removeChild(graph.buttons.pop());\r\n\t\t\t}\r\n\r\n\t\t\t//Check if new values are in range\r\n\t\t\tvar update = false;\r\n\t\t\tfor(var i = 0; i < values.length; i++)\t{\r\n\t\t\t\tif(values[i] < this.min){\r\n\t\t\t\t\tthis.min = Math.ceil(values[i]);\r\n\t\t\t\t\tupdate = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse if(values[i] > this.max){\r\n\t\t\t\t\tthis.max = Math.ceil(values[i] + 1.0);\r\n\t\t\t\t\tupdate = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//If some value not in range update range\r\n\t\t\tif(update)\t{\r\n\t\t\t\tthis.setRange(this.min, this.max);\r\n\t\t\t}\r\n\r\n\t\t\t//Update graph\r\n\t\t\tthis._updateGraph(graph);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return value array of a graph by its name.\r\n\t\t *\r\n\t\t * @method getValue\r\n\t\t * @param {String} name Graph name.\r\n\t\t */\r\n\t\tgetValue : function(name) {\r\n\t\t\tvar graph = this.getGraph(name);\r\n\r\n\t\t\tif(graph !== null)\r\n\t\t\t{\r\n\t\t\t\treturn graph.values;\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get graph object by name.\r\n\t\t *\r\n\t\t * @method getGraph\r\n\t\t * @param {String} name Graph name.\r\n\t\t */\r\n\t\tgetGraph : function(name) {\r\n\t\t\tif(name !== undefined) \t{\r\n\t\t\t\tfor(var i = 0; i < this.graph.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(this.graph[i].name === name)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn this.graph[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this.graph.length > 0)\r\n\t\t\t{\r\n\t\t\t\treturn this.graph[0];\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Update graph canvas and buttons.\r\n\t\t *\r\n\t\t * @method updateGraph\r\n\t\t * @param {Object} graph Graph object.\r\n\t\t */\r\n\t\t_updateGraph : function(graph)\r\n\t\t{\r\n\t\t\tvar width = this.size.x - this.scaleMargin;\r\n\r\n\t\t\t//Get canvas context\r\n\t\t\tvar context = graph.canvas.getContext(\"2d\");\r\n\t\t\tcontext.clearRect(0, 0, width, this.size.y);\r\n\t\t\tcontext.strokeStyle = graph.color;\r\n\t\t\tcontext.lineWidth = \"2\";\r\n\r\n\t\t\t//Draw graph and set button positions\r\n\t\t\tvar step = width / (graph.values.length - 1);\r\n\t\t\tvar delta = this.max - this.min;\r\n\r\n\t\t\tcontext.moveTo(0, graph.values[0] * this.size.y);\r\n\t\t\tcontext.beginPath();\r\n\r\n\t\t\tfor(var i = 0; i < graph.values.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar x = i * step;\r\n\t\t\t\tvar y = (1 - ((graph.values[i] - this.min) / delta)) * this.size.y;\r\n\r\n\t\t\t\tcontext.lineTo(x, y);\r\n\r\n\t\t\t\tvar button = graph.buttons[i];\r\n\t\t\t\tbutton.style.left = x + \"px\";\r\n\t\t\t\tbutton.style.top = y + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tcontext.stroke();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Draw background grid canvas.\r\n\t\t *\r\n\t\t * @method updateGrid\r\n\t\t */\r\n\t\t_updateGrid : function() {\r\n\t\t\tvar width = this.size.x - this.scaleMargin;\r\n\r\n\t\t\tvar context = this.grid.getContext(\"2d\");\r\n\t\t\tcontext.clearRect(0, 0, width, this.size.y);\r\n\t\t\tcontext.strokeStyle = \"#222222\";\r\n\t\t\tcontext.lineWidth = \"1\";\r\n\r\n\t\t\t//Border\r\n\t\t\tcontext.beginPath();\r\n\t\t\tcontext.rect(0, 0, width, this.size.y);\r\n\t\t\tcontext.stroke();\r\n\t\t\tcontext.moveTo(0, 0);\r\n\r\n\t\t\tvar step = width / 10;\r\n\t\t\tif(step <= 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//Vertical lines\t\r\n\t\t\tfor(var i = 0; i < width; i += step) {\r\n\t\t\t\tcontext.beginPath();\r\n\t\t\t\tcontext.moveTo(i, 0);\r\n\t\t\t\tcontext.lineTo(i, this.size.y);\r\n\t\t\t\tcontext.stroke();\r\n\t\t\t}\r\n\r\n\t\t\t//Horizontal lines\r\n\t\t\tfor(var i = 0; i < this.size.y; i += step)\t{\r\n\t\t\t\tcontext.beginPath();\r\n\t\t\t\tcontext.moveTo(0, i);\r\n\t\t\t\tcontext.lineTo(width, i);\r\n\t\t\t\tcontext.stroke();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_updateSize : function() {\r\n\t\t\tWidget.prototype._updateSize.call(this);\r\n\r\n\t\t\tvar width = this.size.x - this.scaleMargin;\r\n\r\n\t\t\t//Grid\r\n\t\t\tthis.grid.width = width;\r\n\t\t\tthis.grid.height = this.size.y;\r\n\t\t\tthis.grid.style.width = width + \"px\";\r\n\t\t\tthis.grid.style.height = this.size.y + \"px\";\r\n\t\t\tthis._updateGrid();\r\n\r\n\t\t\t//Graph\r\n\t\t\tfor(var i = 0; i < this.graph.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar graph = this.graph[i];\r\n\t\t\t\tgraph.canvas.width = width;\r\n\t\t\t\tgraph.canvas.height = this.size.y;\r\n\t\t\t\tgraph.canvas.style.width = width + \"px\";\r\n\t\t\t\tgraph.canvas.style.height = this.size.y + \"px\";\r\n\t\t\t\tthis._updateGraph(graph);\r\n\t\t\t}\r\n\r\n\t\t\t//Scale\r\n\t\t\tvar step = (this.size.y - 14) / (this.scale.length - 1);\r\n\t\t\tfor(var i = 0; i < this.scale.length; i++) {\r\n\t\t\t\tthis.scale[i].style.top = (i * step) + \"px\";\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tGraph.GaphLine = function(canvas, name, color)\r\n\t{\r\n\t\tif(canvas === undefined)\r\n\t\t{\r\n\t\t\tcanvas = document.createElement(\"canvas\");\r\n\t\t\tcanvas.style.position = \"absolute\";\r\n\t\t}\r\n\r\n\t\tthis.canvas = canvas;\r\n\t\tthis.name = (name !== undefined) ? name : \"default\";\r\n\t\tthis.color = (color !== undefined) ? color : \"#FFFFFF\";\r\n\t\tthis.values = [];\r\n\t\tthis.buttons = [];\r\n\t\tthis.onchange = null;\r\n\t};\r\n\r\n\r\n\treturn graphics.Graph = Graph;\r\n});"]}