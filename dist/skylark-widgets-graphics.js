/**
 * skylark-widgets-graphics - The skylark graphic widgets library
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-graphics/
 * @license MIT
 */
!function(t,e){var i=e.define,require=e.require,s="function"==typeof i&&i.amd,a=!s&&"undefined"!=typeof exports;if(!s&&!i){var n={};i=e.define=function(t,e,i){"function"==typeof i?(n[t]={factory:i,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var i=e.split("/"),s=t.split("/");i.pop();for(var a=0;a<s.length;a++)"."!=s[a]&&(".."==s[a]?i.pop():i.push(s[a]));return i.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):n[t]={factory:null,resolved:!0,exports:i}},require=e.require=function(t){if(!n.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=n[t];if(!module.resolved){var i=[];module.deps.forEach(function(t){i.push(require(t))}),module.exports=module.factory.apply(e,i)||null,module.resolved=!0}return module.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-widgets-graphics/graphics",["skylark-langx/skylark"],function(t){return t.attach("widgets.graphics",{})}),t("skylark-widgets-graphics/Graph",["skylark-domx-eventer","skylark-widgets-base/Widget","./graphics"],function(t,e,i){"use strict";var s=e.inherit({_construct:function(t,i,s){e.prototype._construct.call(this,t,"div");this._elm.style.overflow="visible",this.scaleMargin=22,this.buttonRadius=10,this.max=1,this.min=0,this.grid=document.createElement("canvas"),this.grid.style.position="absolute",this.grid.style.marginLeft=this.scaleMargin+"px",this._elm.appendChild(this.grid),this.graph=[],this.addGraph(i,s),this.scale=[],this.createScale(3)},createScale:function(t){for(var e=0;e<this.scale;e++)this._elm.removeChild(this.scale[e]);for(var i=(this.max-this.min)/(t-1),e=0;e<t;e++){var s=document.createElement("div");s.style.position="absolute",s.style.pointerEvents="none",s.style.color=Editor.theme.textColor;var a=document.createTextNode(this.max-i*e);s.text=a,s.appendChild(a),this.scale.push(s),this._elm.appendChild(s)}},_updateScale:function(){for(var t=(this.max-this.min)/(this.scale.length-1),e=0;e<this.scale.length;e++)this.scale[this.scale.length-1-e].text.data=this.min+t*e},addGraph:function(t,e){var i=document.createElement("canvas");i.style.position="absolute",i.style.marginLeft=this.scaleMargin+"px",this._elm.appendChild(i),this.graph.push(new s.GaphLine(i,t,e))},setOnChange:function(t,e){var i=this.getGraph(e);i.onchange=t},setRange:function(t,e){for(var i in this.min=t,this.max=e,this.graph)for(var s=this.graph[i],a=0;a<s.values.length;a++)s.values[a]<t?(s.values[a]=t,null!==s.onchange&&s.onchange(s.values)):s.values[a]>e&&(s.values[a]=e,null!==s.onchange&&s.onchange(s.values));this._updateScale();for(var i=0;i<this.graph.length;i++)this._updateGraph(this.graph[i])},setValue:function(e,i){var s=this,a=this.getGraph(i);for(a.values=e;a.buttons.length<a.values.length;){var n=document.createElement("div");n.style.borderRadius="5px",n.style.backgroundColor=a.color,n.style.cursor="pointer",n.style.position="absolute",n.style.marginTop="-"+this.buttonRadius/2+"px",n.style.marginLeft=this.scaleMargin-this.buttonRadius/2+"px",n.style.width=this.buttonRadius+"px",n.style.height=this.buttonRadius+"px",n.index=a.buttons.length,n.graph=a,n.onmousedown=function(e){var i=this.index,a=this.graph;t.on(window,"mousemove",function(t){var e=t.movementY;a.values[i]-=e*((s.max-s.min)/s.size.y),a.values[i]>s.max?a.values[i]=s.max:a.values[i]<s.min&&(a.values[i]=s.min),null!==a.onchange&&a.onchange(a.values),s._updateGraph(a)}),e.stopPropagation()},this._elm.appendChild(n),a.buttons.push(n)}for(;a.buttons.length>a.values.length;)this._elm.removeChild(a.buttons.pop());for(var r=!1,h=0;h<e.length;h++){if(e[h]<this.min){this.min=Math.ceil(e[h]),r=!0;break}if(e[h]>this.max){this.max=Math.ceil(e[h]+1),r=!0;break}}r&&this.setRange(this.min,this.max),this._updateGraph(a)},getValue:function(t){var e=this.getGraph(t);return null!==e?e.values:null},getGraph:function(t){if(void 0!==t)for(var e=0;e<this.graph.length;e++)if(this.graph[e].name===t)return this.graph[e];return this.graph.length>0?this.graph[0]:null},_updateGraph:function(t){var e=this.size.x-this.scaleMargin,i=t.canvas.getContext("2d");i.clearRect(0,0,e,this.size.y),i.strokeStyle=t.color,i.lineWidth="2";var s=e/(t.values.length-1),a=this.max-this.min;i.moveTo(0,t.values[0]*this.size.y),i.beginPath();for(var n=0;n<t.values.length;n++){var r=n*s,h=(1-(t.values[n]-this.min)/a)*this.size.y;i.lineTo(r,h);var o=t.buttons[n];o.style.left=r+"px",o.style.top=h+"px"}i.stroke()},_updateGrid:function(){var t=this.size.x-this.scaleMargin,e=this.grid.getContext("2d");e.clearRect(0,0,t,this.size.y),e.strokeStyle="#222222",e.lineWidth="1",e.beginPath(),e.rect(0,0,t,this.size.y),e.stroke(),e.moveTo(0,0);var i=t/10;if(!(i<=0)){for(var s=0;s<t;s+=i)e.beginPath(),e.moveTo(s,0),e.lineTo(s,this.size.y),e.stroke();for(var s=0;s<this.size.y;s+=i)e.beginPath(),e.moveTo(0,s),e.lineTo(t,s),e.stroke()}},_updateSize:function(){e.prototype._updateSize.call(this);var t=this.size.x-this.scaleMargin;this.grid.width=t,this.grid.height=this.size.y,this.grid.style.width=t+"px",this.grid.style.height=this.size.y+"px",this._updateGrid();for(var i=0;i<this.graph.length;i++){var s=this.graph[i];s.canvas.width=t,s.canvas.height=this.size.y,s.canvas.style.width=t+"px",s.canvas.style.height=this.size.y+"px",this._updateGraph(s)}for(var a=(this.size.y-14)/(this.scale.length-1),i=0;i<this.scale.length;i++)this.scale[i].style.top=i*a+"px"}});return s.GaphLine=function(t,e,i){void 0===t&&((t=document.createElement("canvas")).style.position="absolute"),this.canvas=t,this.name=void 0!==e?e:"default",this.color=void 0!==i?i:"#FFFFFF",this.values=[],this.buttons=[],this.onchange=null},i.Graph=s}),t("skylark-widgets-graphics/main",["./graphics","./Graph"],function(t){return t}),t("skylark-widgets-graphics",["skylark-widgets-graphics/main"],function(t){return t})}(i),!s){var r=require("skylark-langx-ns");a?module.exports=r:e.skylarkjs=r}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-widgets-graphics.js.map
